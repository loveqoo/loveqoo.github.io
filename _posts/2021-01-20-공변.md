# 공변, 반공변 정의

다음과 같은 상황일 때, 

- `A`타입, `B`타입이 있다.
- `F`가 타입 변환을 일으킨다.
- `A ≤ B`의 의미가 `A`가 `B`의 서브타입이라는 표현이다.

- `A ≤ B` 이고, `F(A) ≤ F(B)` 이면 공변이다.
- `A ≤ B` 이고, `F(B) ≤ F(A)` 이면 반공변이다.

# 자세한 비유 (장황주의)

동물원의 비유로 설명을 하고자 한다.

동물원에는 다음과 같은 조건이 있다.
- 여러 종류의 동물이 섞여있는 케이지는 안전하다. (서로 견제)
- 한 동물이 모여있는 곳에 다른 종류의 동물을 넣으면 안된다. (죽음)

동물원에 두 종류의 사육사가 있다고 가정하자.

- 토끼만 케이지에 넣는 `토끼 사육사`
- 동물을 꺼내기만 하는 `동물 사육사`

`동물 사육사`는 동물을 꺼내서 무엇을 꺼냈는지 사람들에게 외치는 임무가 있다. 그가 진실을 말해야만 한다.

이 두 사육사가 동물원에서 안전하게 동물을 관리하는 게 가장 큰 고민인데 어떤 룰을 만들어야 할까?

1. (A) `토끼 사육사`는 토끼만 넣을 수 있으므로, 토끼를
	2. 토끼 전용 케이지에 넣어야 한다.
	3. 여러 동물이 모여있는 케이지에 넣어야 한다.
4. 만약, `토끼 사육사`가 토끼를
	5. 토끼가 아닌 한 종류의 동물 전용의 케이지에 넣으면 토끼가 죽는다.
6. (B) `동물 사육사`는 동물을 꺼낼 수만 있으므로
	7. 토끼만 있는 케이지에서 한 마리를 꺼내서 '동물'이라고 외쳐도 상관없다.
	8. 그 외의 케이지에서 한 마리를 꺼내서 '토끼'라고 외치면 안된다.

위의 룰을 다음과 같이 바꿔도 말이 된다.

- 토끼 대신에 String
- 동물 대신에 Object
- 케이지 대신에 List
- `토끼 사육사` 대신에 String 쓰기 권한자
- `동물 사육사` 대신에 Object 읽기 권한자

1. (A) `String 쓰기 권한자`는 String만 쓸 수 있으므로, `String`을
	2. `List<String>`에 넣어야 한다.
	3. `List<Object>`에 넣어야 한다.
4. 만약, `String 쓰기 권한자`가 `String`을
	5. `List<String>`이 아닌 `List<Integer>`나 `List<Float>`와 같은 리스트에 넣으면 컴파일 오류가 발생한다.
6. (B) `Object 읽기 권한자`는 `Object`를 꺼낼 수만 있으므로
	7. `List<String>`에서 한 엘리먼트를 꺼내서 `Object` 이라고 외쳐도 상관없다.
	8. `List<Object>`에서 한 엘리먼트를 꺼내서 `String`이라고 외치면 안된다.

A의 경우는,

> `List<Object>`에 `String` 값을 넣는 것은 문제가 없다는 것을 보여준다. 값을 넣을 때는 `List<String>` 이 `List<Object>` 보다 상위 타입처럼 보인다. 
> 왜냐하면, `String`은 두 리스트에 모두 들어갈 수 있는데, `Object`는 `List<Object>`에만 들어갈 수 있기 때문에 더 구체적인 (또는 타입이 더 제한되는) 타입으로 여겨진다.

> 따라서 `String ≤ Object` 일 때, `List<Object> ≤ List<String>` 

> 반공변성(contravariant) 성질

> `List<String>` 이 자바에서는 `List<? super String>`, 코틀린에서는 `List<in String>` 으로 표기된다.

> `Consumer-Super` 라고 불리기도 한다. 또는 `Lower Bounded` 라고 불리기도 한다.

B의 경우는,

> `List<String>` 컬렉션의 값을 `Object`로 읽는 것은 문제가 없다는 것을 보여준다. 
> 값을 읽을 때는 String, Object 의 관계처럼 `List<String>`, `List<Object>`도 타입을 따라간다. 
> 왜냐하면, 두 리스트에서 모두 원소를 `Object`로 읽을 수 있지만, `String` 으로 읽을 수 있는 것은 `List<String>`만 가능하다. 
> 때문에 `List<String>`더 구체적인 (또는 타입이 더 제한되는) 타입으로 여겨진다.

> 따라서 `String ≤ Object` 일 때, `List<String> ≤ List<Object>` 

> 공변성(covariant) 성질

> `List<String>` 이 자바에서는 `List<? extends String>`, 코틀린에서는 `List<out String>`으로 표기된다.

> `Producer-Extends` 라고 불리기도 한다. 또는 `Upper Bounded` 라고 불리기도 한다.

출처: https://iosroid.tistory.com/70
